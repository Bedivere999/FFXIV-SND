--[[

  ****************************************
  *            Fate Farming              * 
  ****************************************

  ***********
  * Version *
  *  0.0.2  *
  ***********

    -> 0.0.2: Filterd out fates u need to actiavte, 
              added a function that walks to the targetet enemy, 
              added a function that auto turns on Pandora and RS stuff, 
              added a function that checks if ur mounted or not and mounts u then

  Created by: Prawellp
  Special Thanks to: UcanPatates, Ice and croizat for the Help doing this

  *********************
  *  Required Plugins *
  *********************


  Plugins that are used are:
  -> VNavmesh (for pathing) AND Visland: https://puni.sh/api/repository/veyn
  -> Pandora : https://love.puni.sh/ment.json
  -> RotationSolver : https://puni.sh/api/repository/croizat
     -> Target -> activate "Select only Fate targets in Fate" and "Target Fate priority"
  -> Something Need Doing [Expanded Edition] : https://puni.sh/api/repository/croizat
]]

--[[

  **************
  *  Settings  *
  **************
  ]]

FateS = true
-- activates the Fate settings in Pandora
-- Auto-Sync fate and target fate mobs (kind of needed ig)

ChocoboS = true
-- activates the Chocobo settings in Pandora
-- Auto-Summon Chocobo and call him in fight (there is not much time where you are on ground so it will need to use it mid fight)

--[[

  ************
  *  Script  *
  *   Start  *
  ************

]]

--Chocobo settings
if ChocoboS == true then
PandoraSetFeatureState("Auto-Summon Chocobo", true) 
PandoraSetFeatureConfigState("Auto-Summon Chocobo", "Use whilst in combat", true)
elseif ChocoboS == false then
  yield("/e Sad Chocobo noises...")
end

--Fate settings
if FateS == true then
PandoraSetFeatureState("Auto-Sync FATEs", true) 
PandoraSetFeatureState("FATE Targeting Mode", true) 
yield("/wait 1")
elseif FateS == false then
yield("/e I hope u have something that syncs and targets them")
end


--Mounts at the Beginning
if GetCharacterCondition(4) == false then
yield('/gaction "mount roulette"')
yield("/wait 1")
end

--the actual code for the fates and loop
while true do

--gets the Closest Fate
fates = GetActiveFates()
minDistance = 50000
fateId = 0
for i = 0, fates.Count-1 do
  if GetFateDuration(fates[i]) > 0 then
    distance = GetDistanceToPoint(GetFateLocationX(fates[i]), GetFateLocationY(fates[i]), GetFateLocationZ(fates[i]))
    if distance < minDistance then
      minDistance = distance
      fateId = fates[i]
    end
  end
end

--gets the fate location
fateX = GetFateLocationX(fateId)
fateY = GetFateLocationY(fateId)+5
fateZ = GetFateLocationZ(fateId)
LogInfo(fateX.." , "..fateY.." , "..fateZ)

--paths to the fate
PathfindAndMoveTo(fateX, fateY, fateZ, true)

if fateId ~= 0 then
  yield("/e "..fateId)
end

--jumps when mount lands
while (PathIsRunning() or PathfindInProgress()) do
     if GetCharacterCondition(4) and GetCharacterCondition(77) == false then 
        yield("/gaction jump")
        PathfindAndMoveTo(fateX, fateY, fateZ, true)
        yield("/wait 0.3")
     end
end

--dismount when in fate
while IsInFate() and GetCharacterCondition(4) do
     yield("/gaction dismount")
     yield("/wait 0.3")
     end

--locates the mobs in the fate and path to them
while IsInFate() do
    local enemy_x = GetTargetRawXPos()
    local enemy_y = GetTargetRawYPos()
    local enemy_z = GetTargetRawZPos()
    PathfindAndMoveTo(enemy_x, enemy_y, enemy_z)
     yield("/rotation auto")
     yield("/wait 1")
     end
--disables rs when out of fate 
if IsInFate() == false and GetCharacterCondition(26) == false then
    yield("/rotation cancel")
    yield("/wait 1")

    gems = GetItemCount(26807)
    if gems > 900 then
    yield("/e You are Almost capped with ur Bicolor Gems"..gems)
    end
end

--when fate done mount
while IsInFate() == false and GetCharacterCondition(4) == false do
     yield('/gaction "mount roulette"')
     yield("/wait 1")
     end
end
